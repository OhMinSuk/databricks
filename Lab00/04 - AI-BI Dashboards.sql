-- Databricks notebook source
-- MAGIC %md
-- MAGIC ## 04 - AI/BI 대시보드
-- MAGIC
-- MAGIC Databricks AI/BI 대시보드는 향상된 시각화 라이브러리와 간소화된 구성 환경을 제공해 데이터를 공유 가능한 통찰력으로 빠르게 변환하는 데 도움이 됩니다. 
-- MAGIC
-- MAGIC 이번 과정에서는 새 대시보드를 만들고 테이블 데이터와 SQL 쿼리를 기반으로 대시보드에 데이터와 시각화를 추가합니다.
-- MAGIC
-- MAGIC 이 레슨에서는 다음 리소스를 사용합니다:
-- MAGIC * **sales** 테이블
-- MAGIC * **customers** 테이블
-- MAGIC
-- MAGIC 이 표에는 일부 소매 판매 수치와 고객 주문 세부 정보가 포함되어 있습니다. 이를 대시보드의 시각화를 위한 소스 데이터로 사용할 것입니다.
-- MAGIC

-- COMMAND ----------

-- MAGIC %md
-- MAGIC ### 1부: 새 대시보드 만들기
-- MAGIC Databricks에서 새 대시보드를 만드는 것은 간단하고 직관적입니다. 
-- MAGIC * 측면 탐색 창에서 대시보드로 이동합니다.
-- MAGIC * **대시보드 만들기**를 선택합니다. 
-- MAGIC * 결과 화면 상단에서 대시보드 이름을 클릭하고 **소매 대시보드**로 변경합니다.
-- MAGIC
-- MAGIC 이미 대시보드가 있는 경우 대시보드를 가져오는 옵션도 있습니다. 기존 대시보드는 모두 플랫폼의 이 영역에서 찾을 수 있습니다. 플랫폼 전반에 걸쳐 여러 가지 빠른 생성 도구가 있는데, 다른 하위 메뉴에서 대시보드를 만들기 위한 옵션 중 하나로 **대시보드**를 제공합니다.

-- COMMAND ----------

-- MAGIC %md
-- MAGIC ### 2부: 데이터 추가
-- MAGIC
-- MAGIC 완전히 새로운 대시보드를 사용하려면 먼저 대시보드를 데이터에 연결해야 합니다. 대시보드 화면 상단에는 **캔버스**와 **데이터**라는 두 개의 탭이 있습니다. 
-- MAGIC
-- MAGIC - **캔버스:** 캔버스 탭을 사용하면 사용자가 시각화를 만들고 대시보드를 구성할 수 있습니다. 캔버스의 각 항목을 위젯이라고 합니다. 위젯에는 세 가지 유형이 있습니다. 시각화, 텍스트 상자 및 필터.
-- MAGIC
-- MAGIC - **데이터:** **데이터** 탭을 사용하면 대시보드에서 사용할 데이터 세트를 정의할 수 있습니다. UI나 API를 사용하여 데이터 세트를 공유하거나 가져오거나 내보낼 때 대시보드와 함께 데이터 세트가 번들로 제공됩니다.
-- MAGIC
-- MAGIC 시작하려면 **데이터** 탭을 선택하세요. 
-- MAGIC
-- MAGIC 화면 왼쪽에는 세 개의 아이콘이 있습니다. **데이터 세트**, **카탈로그** 및 **어시스턴트**. 
-- MAGIC * **카탈로그**를 사용하면 작업 공간에서 액세스할 수 있는 카탈로그, 스키마 및 테이블을 탐색할 수 있습니다.
-- MAGIC * **어시스턴트**는 자연어로 플랫폼에 쿼리를 보내 객체를 발견하거나 쿼리 작성에 대한 인사이트나 도움을 얻을 수 있는 AI 기반 인터페이스를 제공합니다. 
-- MAGIC * **데이터 세트**는 대시보드에 사용된 모든 데이터 세트와 쿼리 목록을 보여줍니다. 사용 가능한 테이블 목록에서 선택하거나 SQL 쿼리에서 만든 여러 데이터 세트를 단일 대시보드에서 사용할 수 있습니다. 
-- MAGIC
-- MAGIC 다음 단계에서는 이 예제 대시보드에 테이블을 추가하는 과정을 안내합니다.
-- MAGIC
-- MAGIC 1. **데이터 세트 목록** 탭을 선택하고 **+ 테이블 선택** 버튼을 클릭합니다. </p>
-- MAGIC 2. 결과로 나타나는 팝업에서 `sales`를 검색하세요. </p>
-- MAGIC 3. **sales**를 클릭하여 데이터 세트로 추가한 다음 **확인** 버튼을 선택합니다. 데이터 세트 목록에 표시되는지 확인하세요. </p>
-- MAGIC 4. `customers` 테이블을 추가하려면 이 단계를 반복하세요. </p>
-- MAGIC
-- MAGIC 각 테이블은 쿼리 편집 패널에서 자동으로 채워진 `SELECT *` 쿼리 문으로 목록에 추가됩니다. SQL 쿼리를 수정하여 데이터 세트를 변경할 수 있습니다.

-- COMMAND ----------

-- MAGIC %md
-- MAGIC ---
-- MAGIC ### 3부: 시각화 추가
-- MAGIC #### 시각화 1: 카운터
-- MAGIC
-- MAGIC 대시보드에 추가할 첫 번째 비주얼리제이션은 매출 목표인 300만 달러 대비 현재 매출을 표시하는 카운터 비주얼리제이션입니다.
-- MAGIC
-- MAGIC 1. **데이터** 탭에서 **+ SQL에서 만들기** 옵션을 선택합니다. </p>
-- MAGIC 2. 다음 쿼리를 쿼리 편집 공간에 입력하세요:
-- MAGIC `SELECT sum(total_price) AS Total_Sales, 3000000 AS Sales_Goal FROM xxxxx.v01.sales;` </p>
-- MAGIC 3. **실행**을 클릭하여 쿼리를 실행합니다. </p>
-- MAGIC 4. **데이터 세트** 목록에서 쿼리를 마우스 오른쪽 버튼으로 클릭하고 **이름 바꾸기**를 선택하여 쿼리 이름을 **총 판매량 계산**으로 변경합니다. </p>
-- MAGIC 5. **캔버스** 탭으로 돌아갑니다. </p>
-- MAGIC 6. 화면 하단에는 객체 이동, 시각화 추가, 텍스트 상자 추가, 필터 추가를 위한 도구 모음이 있습니다. **시각화 추가**를 선택합니다. </p>
-- MAGIC 7. 화면의 어느 곳으로든 커서를 옮기고 클릭하여 시각화를 캔버스에 추가합니다. </p>
-- MAGIC 8. 오른쪽의 **구성 패널**에서 설정에 대해 다음 선택을 하세요:
-- MAGIC     - **데이터 세트:** 총 판매량 계산
-- MAGIC     - **시각화:** 카운터
-- MAGIC     - **제목:** 체크된
-- MAGIC       - 시각화에서 **위젯 제목**을 클릭합니다.
-- MAGIC       - **판매 목표**로 바꾸세요.
-- MAGIC     - **값:** Total_Sales
-- MAGIC     - **대상:** Sales_Goal
-- MAGIC
-- MAGIC 9. 이제 **Total_Sales**을 클릭하고 드롭다운에서 **형식**을 선택합니다. 그런 다음 **사용자 지정**을 클릭합니다.  다음 조정을 하세요:
-- MAGIC     - **유형:** 통화($)
-- MAGIC     - **약어:** 없음
-- MAGIC     
-- MAGIC 10. 스타일 섹션에서 **조건부 스타일** 옆에 있는 **+** 를 클릭합니다. 다음 설정으로 구성하세요.
-- MAGIC     - Value <= Target인 경우
-- MAGIC     - 그런 다음 (색상: 빨간색)
-- MAGIC
-- MAGIC 정말 간단한 시각화이지만, 대시보드에서 시각화를 사용하는 방법을 체험할 수 있게 해줍니다. 시각화 상자의 가장자리를 드래그하거나, 시각화 상자 위에서 클릭하고 드래그하면 시각화의 위치와 크기를 조정할 수 있습니다.

-- COMMAND ----------

-- MAGIC %md
-- MAGIC ---
-- MAGIC #### 시각화 2: 콤보 차트
-- MAGIC 다음으로, 3개월 동안의 총 판매 가격과 판매 횟수에 대한 정보가 포함된 콤보 차트인 다른 시각화를 추가해 보겠습니다.
-- MAGIC
-- MAGIC 1. **데이터** 탭에서 **+ SQL에서 만들기** 옵션을 선택합니다. </p>
-- MAGIC 2. 다음 쿼리를 쿼리 편집 공간에 입력하고 실행하세요.
-- MAGIC
-- MAGIC ```
-- MAGIC SELECT customer_name, 
-- MAGIC        total_price AS Total_Sales, 
-- MAGIC        date_format(order_date, "MM") AS Month, 
-- MAGIC        product_category 
-- MAGIC FROM xxxxx.v01.sales 
-- MAGIC WHERE order_date >= to_date('2019-08-01')
-- MAGIC AND order_date <=  to_date('2019-10-31');
-- MAGIC ```
-- MAGIC </p>
-- MAGIC
-- MAGIC 3. 쿼리 이름을 **세 달 판매**로 변경하세요. </p>
-- MAGIC 4. **캔버스** 탭으로 돌아갑니다.</p>
-- MAGIC 5. 캔버스 하단의 메뉴에서 **시각화 추가**를 선택하고 캔버스를 클릭하여 시각화를 추가합니다.</p>
-- MAGIC 6. 오른쪽의 **구성 패널**에서 설정에 대해 다음 선택을 하세요.
-- MAGIC     - **데이터 세트:** 세 달 판매
-- MAGIC     - **시각화:** 콤보
-- MAGIC     - **X축:** 월
-- MAGIC     - **Y축:**
-- MAGIC       - **왼쪽 Y축(막대):** Total_Sales
-- MAGIC         - **표시 이름:** 총 판매 금액
-- MAGIC       - **오른쪽 Y축(선):** Total_Sales
-- MAGIC         - **오른쪽 Y축(선)** 을 COUNT로 변경합니다.
-- MAGIC         - **표시 이름:** 판매 주문 수
-- MAGIC 7. Y축 옆에 있는 케밥 메뉴 아이콘을 선택하고 **이중 축 사용**을 클릭합니다.
-- MAGIC
-- MAGIC 이중 축을 활성화하면 두 가지 다른 척도에서 데이터의 변화를 볼 수 있습니다. 8월과 10월의 매출 건수는 낮았지만 금액은 높은 것을 알 수 있습니다. 9월에는 그 반대의 상황입니다.
-- MAGIC
-- MAGIC 8. **왼쪽 Y축** 옆에 있는 케밥 메뉴 아이콘을 선택하세요.</p>
-- MAGIC 9. 유형을 **통화($)** 로 변경합니다.
-- MAGIC
-- MAGIC 축 제목은 차트 시리즈의 표시 이름에 따라 자동으로 조정됩니다. 시리즈 이름 옆에 있는 색상 블록을 선택하여 시리즈의 색상을 조정할 수도 있습니다.

-- COMMAND ----------

-- MAGIC %md
-- MAGIC ---
-- MAGIC #### 시각화 3: Databricks Assistant를 사용한 막대형 차트
-- MAGIC
-- MAGIC 대시보드를 작성할 때 Databricks Assistant에 자연어 프롬프트를 제공하면 요청에 따라 차트가 자동 생성됩니다. Databricks Assistant를 사용하면 대시보드의 데이터 탭에 정의된 모든 데이터 세트를 기반으로 차트를 작성할 수 있습니다. 함께 시도해 봅시다.
-- MAGIC
-- MAGIC 다음 단계를 완료하세요.
-- MAGIC
-- MAGIC 1. 캔버스 하단의 메뉴에서 **시각화 추가**를 선택하고 캔버스를 클릭하여 시각화를 추가합니다.
-- MAGIC 2. 위젯 상단의 텍스트 필드에 다음 프롬프트를 입력하세요: </p>
-- MAGIC
-- MAGIC     product_category를 x축에, total_sales 평균을 y축에 나타내는 막대형 차트를 만듭니다.
-- MAGIC
-- MAGIC 3. **Enter** 키를 누르거나 **제출**을 클릭하여 응답을 생성하세요. 도우미가 시각화를 제공하는 데 시간이 걸릴 수 있습니다. </p>
-- MAGIC 5. 제공된 설명과 일치하는 막대형 차트가 표시됩니다. 시각화가 귀하의 요구 사항을 충족하는지 확인하려면  <b>수락하기</b> 를 클릭하세요. </p>
-- MAGIC
-- MAGIC   시각화가 설명과 일치하지 않거나 만들고 싶었던 시각화 종류와 일치하지 않는 경우 응답을 거부하거나 다시 생성할 수 있습니다. 수락한 후에 차트 구성을 조정할 수도 있습니다. 시각화의 색상을 변경해보세요.
-- MAGIC

-- COMMAND ----------

-- MAGIC %md
-- MAGIC ---
-- MAGIC #### 시각화 4: 산점도
-- MAGIC
-- MAGIC 판매 값이 주문 날짜에 따라 어떻게 달라지는지 이해하기 위해 산점도라는 차트를 하나 더 만들어 보겠습니다. 이 산점도를 만들려면 다음 단계를 완료하세요.
-- MAGIC
-- MAGIC 1. 캔버스 하단의 메뉴에서 **시각화 추가**를 선택하고 캔버스를 클릭하여 시각화를 추가합니다. </p>
-- MAGIC 2. 오른쪽의 **구성 패널**에서 설정에 대해 다음 선택을 하세요. 
-- MAGIC
-- MAGIC     - <b>데이터세트</b>: 판매
-- MAGIC     - <b>시각화</b>: 산점도
-- MAGIC     - <b>X축</b>: order_date
-- MAGIC         - **스케일 유형:** 연속
-- MAGIC         - **변환:** DAILY
-- MAGIC     - <b>Y축</b>: total_price
-- MAGIC         - **척도 유형:** 범주형
-- MAGIC         - **변환:** SUM

-- COMMAND ----------

-- MAGIC %md
-- MAGIC ---
-- MAGIC #### 텍스트 상자 추가
-- MAGIC
-- MAGIC 캔버스에 대시보드의 이름과 텍스트 설명을 위한 공간을 추가해 보겠습니다. 캔버스에 새로운 위젯을 추가하면 다른 위젯도 자동으로 해당 위치에 맞춰 이동합니다. 마우스를 사용하여 위젯을 이동하고 크기를 조정할 수 있습니다. 위젯을 삭제하려면 위젯을 선택한 다음 Delete 키보드 키를 누르세요. 각 위젯의 오른쪽 상단에 있는 케밥 메뉴 아이콘을 사용하여 위젯을 조작할 수도 있습니다.
-- MAGIC
-- MAGIC 대시보드에 텍스트 상자를 추가하려면 다음 단계를 완료하세요.
-- MAGIC
-- MAGIC 1. <p style="color: #0873FF">  <b>텍스트 상자 추가</b> 아이콘을 클릭하십시오. 위젯을 캔버스 맨 위로 드래그합니다. </p>
-- MAGIC 2. 유형: `# Retail organization`
-- MAGIC
-- MAGIC     **참고:** 텍스트 상자는 마크다운을 사용합니다. 포함된 텍스트의  `#` 문자는  <b>소매 조직</b> 이 레벨 1 제목임을 나타냅니다. 기본 마크다운 구문에 대한 자세한 내용은 <a href="https://www.markdownguide.org/basic-syntax/" target="_blank">이 마크다운 가이드</a> 를 참조하세요.
-- MAGIC

-- COMMAND ----------

-- MAGIC %md
-- MAGIC ---
-- MAGIC ### 4부: 게시 및 공유
-- MAGIC
-- MAGIC 대시보드가 완성되면 다른 사람들과 공유하려면 게시해야 합니다. 
-- MAGIC
-- MAGIC 게시된 대시보드는 워크스페이스의 다른 사용자와 공유할 수 있으며, 어카운트 수준에서 등록된 사용자와도 공유할 수 있습니다. 즉, 워크스페이스 액세스 또는 컴퓨트 리소스가 할당되지 않았더라도 Databricks 어카운트에 등록된 사용자에게 대시보드 액세스 권한이 부여될 수 있습니다.
-- MAGIC
-- MAGIC 대시보드를 게시할 때 기본 설정은 **자격 증명 포함**입니다. 게시된 대시보드에 자격 증명을 포함하면 대시보드 뷰어가 **자격 증명을 사용하여 데이터에 액세스하고 이를 지원하는 쿼리를 실행할 수 있습니다**. 자격 증명을 포함하지 않도록 선택하면 대시보드 뷰어는 자체 자격 증명을 사용하여 필요한 데이터와 컴퓨트에 액세스합니다. 시청자가 대시보드를 구동하는 기본 SQL 웨어하우스에 액세스할 수 없거나 기반 데이터에 액세스할 수 없는 경우 _시각화는 렌더링되지 않습니다._
-- MAGIC
-- MAGIC 대시보드를 게시하려면 다음 단계를 완료하세요.
-- MAGIC
-- MAGIC 1. 대시보드 오른쪽 상단에 있는  <b>게시</b> 를 클릭하세요.  <b>게시</b>  대화 상자에서 설정과 참고 사항을 읽어보세요. </p>
-- MAGIC 2. 대화 상자의 오른쪽 하단에 있는  <b>게시</b> 를 클릭합니다. 그러면  <b>공유</b> 대화 상자가 열립니다. 열리지 않으면 대시보드 상단의 **게시** 옆에 있는 **공유**를 선택하면 됩니다.
-- MAGIC     - 텍스트 필드를 사용하여 개별 사용자를 검색하거나  <b>관리자</b> 또는  <b>모든 워크스페이스 사용자</b>와 같이 미리 구성된 그룹과 대시보드를 공유할 수 있습니다. 이 창에서  <b>관리 가능</b>  또는  <b>편집 가능</b>과 같은 레벨별 권한을 부여할 수 있습니다. 권한에 대한 자세한 내용은 <a href="https://docs.databricks.com/en/security/auth-authz/access-control/index.html#lakeview" target="_blank">대시보드 ACL</a> 을 참조하세요.
-- MAGIC     -  <b>공유</b>  대화 상자 하단에서 보기 액세스를 제어합니다. 이 설정을 사용하면 모든 어카운트 사용자와 쉽게 공유할 수 있습니다.
-- MAGIC 3. <p style="color: #0873FF">  <b>공유 설정</b>에서 <b>조직의 모든 사람이 볼 수 있음</b>을 드롭다운 메뉴에서 선택합니다. 그런 다음  <b>공유</b> 대화 상자를 닫습니다. </p>
-- MAGIC 4. <p style="color: #0873FF"> 대시보드 상단에 있는 드롭다운을 사용하여 대시보드의  <b>초안</b> 버전과  <b>게시된</b> 버전 간에 전환합니다. </p>
-- MAGIC
-- MAGIC **참고:** 초안 대시보드를 편집할 경우, 게시된 대시보드를 보는 사람은 다시 게시하기 전까지 변경 사항을 볼 수 없습니다. 게시된 대시보드에는 새로운 데이터가 도착하면 업데이트할 수 있는 쿼리를 기반으로 구축된 시각화가 포함되어 있습니다. 대시보드는 다시 게시하지 않고도 새로운 데이터로 자동으로 업데이트됩니다.

-- COMMAND ----------

-- MAGIC %md
-- MAGIC ---
-- MAGIC ### 5부: 대화형 기능: 필드 필터
-- MAGIC 랩에서 만든 대시보드는 보고에 유용하며, 사용자는 이를 사용하여 최신 소매 판매 수치에 대한 최신 정보를 얻을 수 있습니다. 하지만 사용자에게는 데이터를 더 자세히 탐색할 수 있는 제어 기능이 없습니다. 예를 들어, 사용자가 특정 기간의 데이터를 보고 싶다면 대시보드 작성자에게 연락하여 변경 사항을 요청해야 합니다.
-- MAGIC
-- MAGIC 뷰어가 필드나 매개변수 값을 기준으로 특정 데이터를 필터링할 수 있도록 하는 사용자 컨트롤을 만들 수 있습니다. 필터는 대시보드 뷰가 특정 필드를 필터링하거나 데이터 세트 매개변수를 설정하여 결과를 좁힐 수 있는 위젯입니다. 
-- MAGIC
-- MAGIC 필터는 하나 이상의 데이터세트의 필드에 적용될 수 있습니다. 필드에 필터를 사용하면 사용자는 데이터의 특정 값이나 값 범위에 집중할 수 있습니다. 필터는 선택한 데이터세트를 기반으로 작성된 모든 시각화에 적용됩니다.
-- MAGIC
-- MAGIC 대시보드에 필터를 추가하려면 다음 단계를 완료하세요.
-- MAGIC
-- MAGIC 1. <p style="color: #0873FF"> 대시보드에서 벗어난 경우 다시 대시보드로 돌아가세요. </p>
-- MAGIC
-- MAGIC
-- MAGIC     - **대시보드** 메뉴에서 **소유자** 옵션을 선택하고 본인이 만들거나 소유한 대시보드만 보기를 필터링합니다. 
-- MAGIC
-- MAGIC 2. <p style="color: #0873FF"> 게시된 버전을 보고 있는 경우 대시보드의 초안 버전 보기로 전환하세요. </p>
-- MAGIC 3. <p style="color: #0873FF"> 캔버스 하단 근처에 있는 도구 모음에서  <b>필터</b> 아이콘을 클릭합니다.
-- MAGIC 4. 위젯을 대시보드 상단에 배치하세요. 텍스트 상자 아래에 추가하는 것도 좋습니다. 대시보드의 위젯을 재배치하여 원하는 대로 구성할 수 있습니다. </p>
-- MAGIC
-- MAGIC 5. 필터 위젯을 선택하면 화면 오른쪽에 필터 구성 패널이 나타납니다.
-- MAGIC   
-- MAGIC 5. <p style="color: #0873FF"> 다음 설정을 적용합니다: </p>
-- MAGIC   - <b>필터</b>: 단일 값
-- MAGIC   - <b>필드</b>: 
-- MAGIC       - sales.product_category 
-- MAGIC       - Three Month Sales.product_category
-- MAGIC 6. <p style="color: #0873FF"> 체크박스를 사용하여 <b>제목을 활성화하세요</b>. </p>
-- MAGIC 7. <p style="color: #0873FF"> 위젯의 제목을 더블클릭하여  <b>제품 카테고리로 변경합니다.</b> </p>
-- MAGIC 8. <p style="color: #0873FF"> 필터 위젯의 드롭다운을 사용하여 필터를 테스트하세요. </p>
-- MAGIC
-- MAGIC **참고:** 필터는 필터 구성 패널에서 선택한 각 데이터 세트에 적용됩니다. 선택한 모든 데이터 세트는 product_category에 대해 동일한 범위의 값을 공유합니다. 대시보드 뷰어는 대시보드에서 필터링할 데이터를 선택할 때 해당 목록에서 선택할 수 있습니다.
-- MAGIC
-- MAGIC 매개변수를 사용하여 대화형 대시보드를 만들 수도 있습니다. 매개변수를 사용하면 사용자는 런타임에 데이터 세트 쿼리에 값을 대체하여 시각화를 사용자 정의할 수 있습니다. 이는 이 과정의 범위를 벗어나는 내용이므로, 자세한 내용은  <a href="https://docs.databricks.com/en/dashboards/parameters.html" target="_blank">대시보드 매개변수란 무엇인가요?</a> 를 참조하세요.
-- MAGIC
-- MAGIC 게시된 버전에 새 필터가 반영되도록 대시보드를 편집한 후에는 다시 게시해야 합니다.